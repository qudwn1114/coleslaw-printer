<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프린터 테스트</title>
    <script>
        function toggleConnectionType() {
            const type = document.querySelector('input[name="connType"]:checked').value;
            document.getElementById("serialSettings").style.display = type === "serial" ? "block" : "none";
            document.getElementById("networkSettings").style.display = type === "network" ? "block" : "none";
        }

        function printReceipt() {
            const locale = document.getElementById("locale").value;
            const message = document.getElementById("message").value;
            const barcode = document.getElementById("barcode").value;
            const qrcode = document.getElementById("qrcode").value;
            const connType = document.querySelector('input[name="connType"]:checked').value;

            let payload = {
                locale,
                message,
                barcode,
                qrcode,
                connection_type: connType
            };

            if (connType === "serial") {
                payload.port = document.getElementById("serialPort").value;
                payload.baud_rate = parseInt(document.getElementById("baudRate").value);

                if (!payload.port || !payload.baud_rate) {
                    alert("Serial 설정을 모두 입력해주세요.");
                    return;
                }
            } else {
                payload.ip = document.getElementById("ip").value;
                payload.port = parseInt(document.getElementById("netPort").value);

                if (!payload.ip || !payload.port) {
                    alert("Network 설정을 모두 입력해주세요.");
                    return;
                }
            }

            fetch('http://127.0.0.1:5050/print', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => console.log("응답: " + data.message))
            .catch(err => alert("에러 발생: " + err));
        }
    </script>
</head>

<body onload="toggleConnectionType()">
    <h1>프린터 테스트 페이지</h1>

    <div>
        <label>Connection Type:</label><br>

        <input type="radio" id="connSerial" name="connType" value="serial"
            checked onchange="toggleConnectionType()">
        <label for="connSerial">Serial</label>

        <input type="radio" id="connNetwork" name="connType" value="network"
            onchange="toggleConnectionType()">
        <label for="connNetwork">Network</label>
    </div>

    <br>

    <div id="serialSettings">
        <label>Serial Port:</label><br>
        <input type="text" id="serialPort" value="COM2"><br>

        <label>Baud Rate:</label><br>
        <select id="baudRate">
            <option value="9600" selected>9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200">115200</option>
        </select>
    </div>
    <div id="networkSettings" style="display:none;">
        <label>IP Address:</label><br>
        <input type="text" id="ip" placeholder="192.168.0.100"><br>

        <label>Port:</label><br>
        <input type="number" id="netPort" value="9100">
    </div>
    <br>

    <div>
        <label>Locale:</label><br>
        <select id="locale">
            <option value="ko_KR">한국어 (ko_KR)</option>
            <option value="ja_JP">일본어 (ja_JP)</option>
        </select>
    </div>

    <br>

    <div>
        <label>Message:</label><br>
        <textarea id="message" rows="5" cols="40">테스트 영수증입니다.</textarea>
    </div>

    <br>

    <div>
        <label>Barcode:</label><br>
        <input type="text" id="barcode">
    </div>

    <br>

    <div>
        <label>QRcode:</label><br>
        <input type="text" id="qrcode">
    </div>

    <br>

    <button onclick="printReceipt()">영수증 인쇄</button>
</body>
</html>
